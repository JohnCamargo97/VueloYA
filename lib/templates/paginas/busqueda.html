{% extends "footer.html" %}

{% block titulo %} Busqueda {% endblock %}

{% load static %}

{% load humanize %}

{% block contenido %} 

<script src="{% static 'js/script.js' %}"></script>

<div class="container-fluid mauro-seis">
  <div class="container">

    <div class="contenedor-texto-vuelos">
      <h3 class="texto-vuelos-econtrados">Se muestran resultados de {{origen}} a {{destino}}</h3>
    </div>

    <div class="contenedor-busqueda-vuelos">

      <div class="contenido-busquedas">

        <form class="formulario-uno" action="#" method="POST">
          {% csrf_token%}
          <div class="container mauro-dos">

            <div class="container navbar-uno">
      
              <nav class="navbar">
                <h5 class="navbar-title">VUELOS <img src="{% static 'favicon.ico/IconoAvion.png' %}" alt="Icono Avion"></h5>
              </nav>
      
                  <div class="contenedor-origen-destino row">
      
                    <div class="col">
                      <label for="origen">Origen</label>
                      <input class="origen" type="text" id="origen" name="origen" placeholder="Ingresa Origen" required>
                    </div>
      
                    <div class="col">
                      <label for="destino">Destino</label>
                      <input class="destino" type="text" id="destino" name="destino" placeholder="Ingresa Destino" required>
                    </div>
      
                  </div>
      
      
                  <div class="contenedor-fechas-vuelos row">
      
                    <div class="col">
                      <label for="fecha-ida">Fecha Ida</label>
                      <input class="fecha-ida" type="date" id="fecha-ida" name="fecha-ida">
                    </div>
      
                    <div class="col">
                      <label for="fecha-regreso">Fecha Regreso</label>
                      <input class="fecha-regreso" type="date" id="fecha-regreso" name="fecha-regreso">
                    </div>
      
                  </div>
      
      
                  <div class="contenedor-pasajeros row">
      
                    <div class="col">
      
                      <label for="pasajeros">Número de Pasajeros</label>
                      <select class="num-pasajeros" id="pasajeros" name="pasajeros" required>
                        <option value="1">1 pasajero</option>
                        <option value="2">2 pasajeros</option>
                        <option value="3">3 pasajeros</option>
                        <option value="4">4 pasajeros</option>
                      </select>
                      
                    </div>
      
                  </div>
                  
                  <button class="boton-busqueda" type="submit" name="busqueda", value="busqueda">Buscar</button>
      
            </div>
          </div>
        </form>

        <form class="formulario-dos" action="#" method="GET">
          {% csrf_token%}

          <div class="filtro-precio">

            <div class="accordion accordion-flush" id="accordionFlushExample">
              <div class="accordion-item-s">
                <h2 class="accordion-header" id="flush-headingOne" style="flex-grow: 0!important;">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                  Filtro de Precios
                  </button>
                </h2>
                <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                  <div class="accordion-body">

                    <div class="rango-valor">

                      <output id="output">COP 10.000.000</output>
                      <input class="rango-valor-vuelos" type="range" name="precio__lt" min="450000" step="50000" max="10000000" id="id_rango_precio" value= "10000000">
                      
                      <script>
                        document.getElementById("id_rango_precio").oninput = function() { 
                          var val = document.getElementById("id_rango_precio").value //gets the oninput value
                          const formatter = new Intl.NumberFormat('en-US', {style: 'currency',currency: 'COP',});                       
                          let valFormatted = formatter.format(val);
                          document.getElementById('output').innerHTML = valFormatted //displays this value to the html page
                         };                                       
                      </script>
                      
                      <div class="rango-precios">
                        <h3 class="texto-moneda">$ 450.000</h3>
                        <h3 class="texto-moneda ">$ 10.000.000</h3>
                      </div>

                      
                    </div>

                    <div class="contenedor-elegir-moneda">
                      
                      <div class="monedas-para-elegir">

                        <h3 class="texto-moneda">Moneda</h3>

                          <select class="num-monedas" name="moneda" id="id_moneda">
                            <option class="opciones-monedas" value="COP">COP</option>
                            <option class="opciones-monedas" value="USD">USD</option>
                            <option class="opciones-monedas" value="EUR">EUR</option>
                          </select>

                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          
          </div>

          <div class="filtro-aerolineas">

            <div class="accordion accordion-flush" id="accordionFlushExample">
              <div class="accordion-item-s">
                <h2 class="accordion-header" id="flush-headingOne" style="flex-grow: 0!important;">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                  Filtros de Aerolíneas
                  </button>
                </h2>

                <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">

                  <div class="accordion-body">

                    <div class="contenedor-selecion-aerolineas" id="id_aerolinea">

                      {% for aerolinea in aerolineas%}

                        <div class="aerolineas">
                          <input class="input-aerolineas" type="checkbox" id="id_aerolinea" name="id_aerolinea" value="{{aerolinea.1}}">
                          <label class="label-aerolineas">{{aerolinea.0}}</label>
                          <span>({{aerolinea.2}})</span>
                        </div>

                      {% endfor %}

                    </div>

                  </div>

                </div>

              </div>
            </div>       
          </div>

          <button class="boton-filtrar" type="submit" name="filtro" value="filtro"> Filtrar</button>

        </form>

      </div>

  

      <div  class="resultados-busqueda">
        
        <div class="imagen-informacion">
          <div>
            <h5 class="texto-prueba">Ofertas que no te <br> puedes perder!</h5>
          </div>
        </div>

        {% for vuelo in lista_resultado %}

          <div class="uno">
            <div class="busqueda-vuelos">

              <div class="ida-vuelo">
                  <div class="icono-avion">
                      <span> <img src="{% static 'favicon.ico/IconoSalidaAvion.png' %}" alt="Icono Avion Ida"> IDA</span>
                  </div>
                  <div class="fecha-salida-avion">
                      <span>{{vuelo.fechasalida}}</span>
                  </div>
              </div>

              <div class="info-vuelos">
                  <div class="nombre-aerolinea">
                      <span> <img class="logo-de-aerolineas" src="{{vuelo.id_aerolinea.logo_aerolinea.url}}" alt="Aerolinea"> {{vuelo.id_aerolinea.nombre_aerolinea}}</span>
                  </div>
                  <div class="horario-viaje">
                    <div class="contenedor-horario-vuelo">
                      <span style="cursor: pointer;"> {{vuelo.origen}} </span>
                      <span style=" font-weight: bold;"> {{vuelo.horasalida1}} </span>
                    </div>
                      <span>----</span>
                    <div class="contenedor-horario-vuelo">
                      <span style="cursor: pointer;"> {{vuelo.destino}} </span>
                      <span style="display: block; font-weight: bold;"> {{vuelo.horasalida2}} </span>
                    </div>
                      <span>----</span>
                      <span style="cursor: pointer;"> <img src="{% static 'favicon.ico/IconoMaleta.png' %}" alt=""></span>
                  </div>
                  <span  id="duracion" class="tiempo-viaje"> Duración de Viaje {{vuelo.horasalida1}} </span>
                  <script> 
                    document.getElementById("duracion").innerHTML = 'Duracion de Viaje ' + getDuration("{{vuelo.horasalida1}}", "{{vuelo.horasalida2}}");
                 </script>
              </div>



              <div class="regreso-vuelo">
                  <div class="icono-avion">
                      <span> <img src="{% static 'favicon.ico/IconoRegresoAvion.png' %}" alt="Icono Avion Ida"> Regreso</span>
                  </div>
                  <div class="fecha-regreso-avion">
                      <span>{{vuelo.fechavuelta}}</span>
                  </div>
              </div>

              <div class="info-vuelos">
                  <div class="nombre-aerolinea">
                      <span> <img class="logo-de-aerolineas"  src="{{vuelo.id_aerolinea.logo_aerolinea.url}}" alt="Aerolinea"> {{vuelo.id_aerolinea.nombre_aerolinea}}</span>
                  </div>
                  <div class="horario-viaje">
                    <div class="contenedor-horario-vuelo">
                      <span style="cursor: pointer;"> {{vuelo.destino}} </span>
                      <span style="font-weight: bold;"> {{vuelo.horavuelta1}} </span>
                    </div>
                      <span>----</span>
                    <div class="contenedor-horario-vuelo">
                      <span style="cursor: pointer;"> {{vuelo.origen}} </span>
                      <span style="font-weight: bold;"> {{vuelo.horavuelta2}} </span>
                    </div>
                      <span>----</span>
                      <span style="cursor: pointer;"> <img src="{% static 'favicon.ico/IconoMaleta.png' %}" alt=""></span>
                  </div>
                  <span class="tiempo-viaje"> Duración de Viaje 8hrs 30min. </span>
              </div>

              <div class="precio-total-vuelo">

                  <div class="precio-final">
                      <span> Precio final a pagar </span>
                      <span style="font-weight: bold; font-size: 20px; display: block;">$ {{vuelo.precio|intcomma}} COP</span>
                  </div>
                      <a class="boton-comprar-busqueda" href="{% url 'pagos' pk=vuelo.pk%}">Comprar</a>
              </div>
            </div>
          </div>

        {% endfor %}
    
        <div class="pagination">

          {% if page_obj.has_previous %}

            <a class="contenedor-boton-anterior-and-siguiente" href="?page=1">&laquo;</a>

            <a class="contenedor-boton-anterior-and-siguiente" href="?page={{ page_obj.previous_page_number }}" >&lt;</a>

          {% else %}

              <span class="contenedor-boton-inicio-and-final">&laquo;</span>

              <span class="contenedor-boton-inicio-and-final">&lt;</span>

          {% endif %}
      
              <span class="contenedor-paginacion-actual">
                {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
              </span>
      
          {% if page_obj.has_next %}
          
              <a class="contenedor-boton-anterior-and-siguiente" href="?page={{ page_obj.next_page_number }}">&gt;</a>

              <a class="contenedor-boton-anterior-and-siguiente" href="?page={{ page_obj.paginator.num_pages }}">&raquo;</a>

          {% else %}
          
              <span class="contenedor-boton-inicio-and-final"> &gt;</span>

              <span class="contenedor-boton-inicio-and-final">&raquo;</span>   

          {% endif %}

        </div>

      </div>

    </div>

  </div>
</div>

{% endblock %}

